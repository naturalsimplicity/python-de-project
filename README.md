# Итоговый проект по дисциплине Python для DE

Проект представляет собой группу приложений, которые реализуют полный цикл
обработки данных: от генерации сырых данных до их аналитики.

## Компоненты проекта

1. `Producer` — Python-сервис, который имитирует поведение OLTP-приложения,
генерируя синтетические данные по покупкам в некотором интернет-магазине.
Сервис осуществляет запись данных о пользователях, товарах и заказах 
в свою базу данных `Postgres`, а также публикует их в виде сообщений 
в `Kafka` для дальнейшего использования аналитическими сервисами
2. `Postgres` — основная база данных для сервиса `Producer`
3. `Kafka` — брокер сообщений для репликации данных между OLTP и OLAP хранилищами
4. `MySQL` — база данных, используемая в качестве OLAP-хранилища для аналитики
данных основного сервиса
5. `Consumer` — Python-сервис, предназначенный для чтения данных из топиков `Kafka` 
и их записи в БД `MySQL`. Чтение и запись осуществляются в потоковом режиме с
использованием `Spark Structured Streaming`, за счет чего достигается Near Real Time (NRT)
репликация данных из БД источника в БД аналитики
6. `Spark` — кластер для обработки больших данных. Включает в себя master- и worker-узлы
7. `Airflow` — оркестратор для выполнения ETL операций над данными. Состоит из web-сервера, 
планировщика и БД для хранения метаинформации. Внутри сервиса реализован граф (DAG)
формирования двух аналитических витрин на основе данных БД `MySQL`. Расчет витрин реализован
с помощью pyspark и выполняется на кластере.
8. `Jupiter Hub` — опциональный компонент, используемый для аналитики данных и разработки
витрин. На сервере предустановлены необходимые инструменты для работы с кластером `Spark`

## Описание данных

### Исходные данные

Сущность `user` — пользователи сервиса:

- `user_id` — уникальный идентификатор пользователя
- `first_name` — имя пользователя
- `last_name` — фамилия пользователя
- `email` — адрес электронной почты
- `phone_number` — номер телефона
- `registration_date` — дата и время регистрации
- `loyalty_status` — уровень лояльности (Platinum, Gold, Silver, Basic)

Сущность `products` — товары сервиса:

- `product_id` — идентификатор товара
- `name` — название товара
- `description` — описание товара
- `category_id` — идентификатор товара (`product_categories.category_id`)
- `price` — базовая цена
- `stock_quantity` — количество в наличии
- `creation_date` — дата и время добавления товара в ассортимент

Сущность `product_categories` — категории товаров

- `category_id` — идентификатор категории товаров
- `name` — название категории
- `parent_category_id` — идентификатор родительской категории (`product_categories.category_id`)

Сущность `orders` — заказы

- `order_id` — идентификатор заказа
- `user_id` — идентификатор пользователя магазина (`users.user_id`)
- `order_date` — дата и время оформления заказа
- `total_amount` — общая сумма заказа в долларах
- `status` — статус заказа (Completed, Paid, Pending, Aborted)
- `delivery_date` — дата и время доставки заказа покупателю

Сущность `order_details` — состав заказов

- `order_detail_id` — идентификатор детали заказа
- `order_id` — идентификатор заказа (`orders.order_id`)
- `product_id` — идентификатор товара (`products.product_id`)
- `quantity` — количество товара в заказе
- `price_per_unit` — цена товара в заказе за единицу 
- `total_amount` — общая стоимость товара за всю позицию в заказе

### Аналитические витрины

Витрина `user_sales` — агрегация по продажам в разрезе покупателей

- `order_month` — отчетный месяц витрины (срез)
- `loyalty_status` — статус лояльности группы покупателей (срез)
- `orders_cnt` — общее количество заказов в рамках периода и группы (метрика)
- `paid_orders` — количество оплаченных заказов (метрика)
- `completed_orders` — количество завершенных заказов (метрика)
- `pending_orders` — количество заказов, ожидающих доставки (метрика)
- `aborted_orders` — количество отмененных заказов (метрика)
- `unique_users` — количество уникальных покупателей за отчетный месяц (метрика)
- `total_order_amount` — общая сумма всех заказов (метрика)
- `avg_order_amount` — средняя сумма заказа (метрика)
- `total_revenue` — общая выручка магазина (без учета отмененных заказов) (метрика) 
- `avg_delivery_period` — средний срок доставки заказа в днях (метрика)

Витрина `product_sales` — агрегация по продажам в разрезе товаров

- `order_month` — отчетный месяц витрины (срез)
- `product_category` — категория товара (срез)
- `product_name` — наименование товара (срез)
- `order_cnt` — количество заказов (метрика)
- `ordered_quantity` — количество заказанных единиц товара (метрика)
- `aborted_quantity` — количество единиц товара в отмененных заказах (метрика)
- `paid_quantity` — количество единиц товара в оплаченных заказах (метрика)
- `pending_quantity` — количество единиц товара в заказах, ожидающих доставки (метрика)
- `completed_quantity` — количество единиц товара в завершенных заказах (метрика)
- `total_amount` — общая сумма заказанным товарам (метрика)
- `total_revenue` — общая выручка магазина по товару (без учета отмененных заказов) (метрика)
